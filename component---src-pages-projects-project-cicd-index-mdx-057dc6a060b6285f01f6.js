(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{"2yob":function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return o})),a.d(t,"default",(function(){return s}));a("91GP"),a("rGqo"),a("yt8O"),a("Btvt"),a("RW0V"),a("q1tI");var i=a("7ljp"),n=a("013z");a("qKvR");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}var o={},l={_frontmatter:o},c=n.a;function s(e){var t=e.components,a=function(e,t){if(null==e)return{};var a,i,n={},r=Object.keys(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,["components"]);return Object(i.b)(c,r({},l,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",null,"Challenge"),Object(i.b)("p",null,"You are provided with the challenge to implement a demo that shows best practices for DevOps.\nImplement Continous Integration and Continous Deployment for an Application on Kubernetes."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Git repository with application code and Dockerfile, Developers have access to this git repository"),Object(i.b)("li",{parentName:"ul"},"Git repository with pipeline manifest files (ie yamls) files, Operators have access to this repository"),Object(i.b)("li",{parentName:"ul"},"Git repository with application manifest (ie yaml) files, automation only have access to this repository")),Object(i.b)("h2",null,"Specifications"),Object(i.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"818px"}},"\n      ",Object(i.b)("span",r({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"31.59722222222222%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABLElEQVQY011RS07DMBDNZTkCN+AOHIItYgEbFlUlyKJsWBQqmqRq/g12fo5/eYzdn8RIT54ZzxvPPAdwNltIKWGNwUwhLw8oNjEsRS6nlPKnL51nnG0mnr2EFkYbBExb9ARNJCEmKK1QpRWi9Q7aaP+QIggqbtSR7eqstVRLYCt8RjneFjuIMERwlxg85ERqGapDjbIoIKYJbdeCc440y2HHHq95h9sfjW4UiMMl6v0O/TSjWd0gi55BVKh0j2C5TbEpGxglwdsOv4z7qdwU4ziiHwbISSBjLRZR5ieMv9foOKMNDJJkC9bUfuWeBgn0OECR4+wplLh/bMkz0LSiMSfQeq6pcE209o3Od1IqOq2XwCHw4p5k/fjieHnPjxKT2u4Dzrh+xP/89c7ZHxOmzVvIViJ9AAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(i.b)("img",r({parentName:"span"},{className:"gatsby-resp-image-image",alt:"overview-diagram",title:"overview-diagram",src:"/static/e0f59cda603cd30cfc3a5138da9d879c/96d67/tekton-argocd.png",srcSet:["/static/e0f59cda603cd30cfc3a5138da9d879c/7fc1e/tekton-argocd.png 288w","/static/e0f59cda603cd30cfc3a5138da9d879c/a5df1/tekton-argocd.png 576w","/static/e0f59cda603cd30cfc3a5138da9d879c/96d67/tekton-argocd.png 818w"],sizes:"(max-width: 818px) 100vw, 818px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(i.b)("h3",null,"Code Git Repository"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",r({parentName:"li"},{href:"https://github.com/ibm-cloud-architecture/tutorial-tekton-argocd-code"}),"Git repository with application code")),Object(i.b)("li",{parentName:"ul"},"Create a new git repository using this repo as ",Object(i.b)("a",r({parentName:"li"},{href:"https://github.com/ibm-cloud-architecture/tutorial-tekton-argocd-code/generate"}),"template")),Object(i.b)("li",{parentName:"ul"},"Use the ",Object(i.b)("inlineCode",{parentName:"li"},"Dockerfile")," on the root of the repository to build a container image")),Object(i.b)("h3",null,"Infra Git Repository"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",r({parentName:"li"},{href:"https://github.com/ibm-cloud-architecture/tutorial-tekton-argocd-infra"}),"Git repository with application manifest")),Object(i.b)("li",{parentName:"ul"},"Create a new git repository using this repo as ",Object(i.b)("a",r({parentName:"li"},{href:"https://github.com/ibm-cloud-architecture/tutorial-tekton-argocd-infra/generate"}),"template")),Object(i.b)("li",{parentName:"ul"},"The directory ",Object(i.b)("inlineCode",{parentName:"li"},"ocp/yamls")," contains the application manifest files")),Object(i.b)("h3",null,"Pipeline Git Repository"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Create new repository to store pipeline resources"),Object(i.b)("li",{parentName:"ul"},"Use the ServiceAccount ",Object(i.b)("inlineCode",{parentName:"li"},"pipeline")),Object(i.b)("li",{parentName:"ul"},"Use the following guide to create a Pipeline, Tasks, and secret:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Create a pipeline, tasks, secrets on the target namespace"),Object(i.b)("li",{parentName:"ul"},"Git clone the source code from the App repo"),Object(i.b)("li",{parentName:"ul"},"Build a container image using the ",Object(i.b)("inlineCode",{parentName:"li"},"Dockerfile")," on the repo"),Object(i.b)("li",{parentName:"ul"},"Tag the image using the 7 first characters of the git hash corresponding to last git commit"),Object(i.b)("li",{parentName:"ul"},"Push the container image into the internal image registry on the same namespace"),Object(i.b)("li",{parentName:"ul"},"Git clone the Infra git repo"),Object(i.b)("li",{parentName:"ul"},"Update the image on the deployment yaml with the new image id that has the tag with value of the git commit"),Object(i.b)("li",{parentName:"ul"},"Git commit the changes"),Object(i.b)("li",{parentName:"ul"},"Git push the changes to the infra git repo, this should trigger argocd to pickup any changes from the infra repo.")))),Object(i.b)("h2",null,"Hints"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"The secret contains the git username and token with permission ",Object(i.b)("inlineCode",{parentName:"li"},"repo")," that gives write access to the git infra repository"),Object(i.b)("li",{parentName:"ul"},"OpenShift 4 comes with an internal image registry you can push from a Tekton task"),Object(i.b)("li",{parentName:"ul"},"The image registry url contains the service name, port, namespace, image name and tag",Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",r({parentName:"pre"},{}),"image-registry.openshift-image-registry.svc:5000/my-namespace-app/image-name:my-tag\n"))),Object(i.b)("li",{parentName:"ul"},"The image registry only handles ssl/https connections, but it uses a self sign certificate"),Object(i.b)("li",{parentName:"ul"},"You need to ignore TLS-Verify to be able to succesfully push and ignore ssl errors for example using buildah set the flag ",Object(i.b)("inlineCode",{parentName:"li"},'--tls-verify="false"'))),Object(i.b)("h2",null,"Extra Credit"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Make the pipeline to run automatically every time new code gets pushed to the Code git repository",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Configure a Github Webhook using the new ",Object(i.b)("a",r({parentName:"li"},{href:"https://github.com/tektoncd/triggers"}),"Tekton Triggers")," listener and bindings")))),Object(i.b)("h2",null,"Solution"),Object(i.b)("p",null,"Here is one implementation as a ",Object(i.b)("a",r({parentName:"p"},{href:"./solution"}),"solution")))}s.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-projects-project-cicd-index-mdx-057dc6a060b6285f01f6.js.map