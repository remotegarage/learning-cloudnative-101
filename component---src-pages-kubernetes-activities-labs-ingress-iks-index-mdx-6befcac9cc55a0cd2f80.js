(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{"2w8T":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return l})),n.d(t,"default",(function(){return i}));n("91GP"),n("rGqo"),n("yt8O"),n("Btvt"),n("RW0V"),n("q1tI");var a=n("7ljp"),r=n("013z");n("qKvR");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var l={},o={_frontmatter:l},c=r.a;function i(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,["components"]);return Object(a.b)(c,s({},o,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"The ",Object(a.b)("a",s({parentName:"p"},{href:"https://www.ibm.com/cloud/container-service"}),"IBM Kubernetes service")," free clusters consist of a single worker node with 2 CPU and 4 GB of memory for experimenting with Kubernetes. Unlike the fee-based service, these clusters do not include capabilities for application load balancing using ingress out-of-the-box. "),Object(a.b)("h2",null,"Prerequisites"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Free IBM Kubernetes Cluster (IKS) - upgrade your account from ",Object(a.b)("strong",{parentName:"li"},"Lite")," plan to create one. In the example commands, weâ€™ll assume that this cluster is named ",Object(a.b)("inlineCode",{parentName:"li"},"mycluster")),Object(a.b)("li",{parentName:"ul"},"kubectl - match your cluster API version "),Object(a.b)("li",{parentName:"ul"},"Log in to IBM Cloud and configure ",Object(a.b)("inlineCode",{parentName:"li"},"kubectl")," using the ",Object(a.b)("inlineCode",{parentName:"li"},"ibmcloud ks cluster config --cluster mycluster")," command")),Object(a.b)("h2",null,"Components"),Object(a.b)("p",null,"On the IKS cluster, you will install helm charts for a ",Object(a.b)("a",s({parentName:"p"},{href:"https://github.com/nginxinc/kubernetes-ingress/tree/release-1.7/deployments/helm-chart"}),"nginx ingress controller")," from NGINX. This lab already provides the templated yaml files so there is no need to use helm cli."),Object(a.b)("h2",null,"Set up the ingress controller"),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Only do this on a free IKS instance")," These steps assume facts that only apply to free IKS instances:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"a single worker where the cluster administrator can create pods that bind to host ports"),Object(a.b)("li",{parentName:"ul"},"no pre-existing ingress controller or application load balancer")),Object(a.b)("p",null,"Using the following steps with a paid instance can cause issues. See the ",Object(a.b)("a",s({parentName:"p"},{href:"https://cloud.ibm.com/docs/containers?topic=containers-cs_network_planning"}),"IBM Cloud containers documentation")," for information on exposing applications with the ingress/alb services for paid clusters. ",Object(a.b)("strong",{parentName:"p"},"You have been warned")),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Install the NGINX ingress controller with ",Object(a.b)("inlineCode",{parentName:"p"},"helm")," using a daemonset and no service resource (which will result in a single pod that binds to ports 80 and 443 on the worker node and will skip creation of a ",Object(a.b)("inlineCode",{parentName:"p"},"ClusterIP, LoadBalancer, or NodePort")," for the daemonset)."),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",s({parentName:"pre"},{className:"language-bash"}),"kubectl apply -f https://cloudnative101.dev/yamls/ingress-controller/iks-ingress-v1.7.1.yaml\n"))),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"You can use free domain ",Object(a.b)("inlineCode",{parentName:"p"},".nip.io")," to get a domain name using one of the IP Address of your worker nodes. Run this command to set your DOMAIN"),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",s({parentName:"pre"},{className:"language-bash"}),"export DOMAIN=$(kubectl get nodes -o jsonpath='{.items[0].status.addresses[?(@.type==\"ExternalIP\")].address}').nip.io\necho $DOMAIN\n"))),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"You can test the ingress controller using the ",Object(a.b)("inlineCode",{parentName:"p"},"$DOMAIN"),":"),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",s({parentName:"pre"},{className:"language-bash"}),"curl -I http://$DOMAIN\n")),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",s({parentName:"pre"},{}),"HTTP/1.1 404 Not Found\nServer: nginx/1.17.10\n...\n")),Object(a.b)("p",{parentName:"li"},"A ",Object(a.b)("strong",{parentName:"p"},"404")," is expected at this point because unlike the ",Object(a.b)("a",s({parentName:"p"},{href:"https://github.com/kubernetes/ingress-nginx"}),"kubernetes nginx ingress"),", the NGINX version of the ingress controller does not create a default backend deployment.")),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"To use the ingress controller deploy a sample application, expose a service."),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",s({parentName:"pre"},{className:"language-bash"}),"kubectl create deployment web --image=bitnami/nginx\nkubectl expose deployment web --name=web --port 8080\n"))),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Now create an Ingress resource"),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",s({parentName:"pre"},{className:"language-bash"}),'cat <<EOF | kubectl apply -f -\napiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: web\n  labels:\n    app: web\nspec:\n  rules:\n    - host: web.$DOMAIN\n      http:\n        paths:\n          - path: /\n            backend:\n              serviceName: web\n              servicePort: 8080\nEOF\necho "Access your web app at http://web.$DOMAIN"\n'))),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"List the created ingress"),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",s({parentName:"pre"},{className:"language-bash"}),"kubectl get ingress web\n"))),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Access your web application"),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",s({parentName:"pre"},{className:"language-bash"}),"curl http://web.$DOMAIN\n")),Object(a.b)("p",{parentName:"li"},"The output prints the html"),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",s({parentName:"pre"},{className:"language-html"}),"<p><em>Thank you for using nginx.</em></p>\n"))),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Delete all the resources created"),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",s({parentName:"pre"},{className:"language-bash"}),"kubectl delete deployment,svc,ingress -l app=web\n")))))}i.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-kubernetes-activities-labs-ingress-iks-index-mdx-6befcac9cc55a0cd2f80.js.map